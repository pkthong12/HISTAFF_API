upstream qlns_vnsteel_web {
    server 192.168.102.41:443;
    zone home 64k;
}
############qlns.vnsteel.vn#########
server {
    listen 80;
    server_name qlns.vnsteel.vn;
    return 301 https://$host$request_uri;
}


server {
    listen       443 ssl;
    server_name qlns.vnsteel.vn;


    #Config ssl_offload
    include /etc/nginx/file_conf/ssl.conf;

    # limit upload file
    include /etc/nginx/file_conf/client_body_size.conf;


    charset koi8-r;
    gzip off;

    access_log  /var/log/nginx/qlns-vnsteel.access.log  main;
    error_log /var/log/nginx/qlns-vnsteel.error.log info;
    status_zone qlns_vnsteel;
    location / {
        include /etc/nginx/file_conf/lb-proxy.conf;
        modsecurity on;
        modsecurity_rules_file /etc/nginx/modsec/main.conf;

        proxy_pass https://qlns_vnsteel_web;
        health_check;
    }
	
	location /api {
        proxy_pass https://192.168.102.41:1945;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
	
	location /hubs/signal {
        proxy_pass https://192.168.102.41:1945/hubs/signal;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
	
	location /jobs {
        proxy_pass https://192.168.102.41:1945/jobs;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

}
